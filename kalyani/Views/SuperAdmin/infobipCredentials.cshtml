@model AutoSherpa_project.Models.infobipcredentials

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="modal fade" id="infobiDetailsModal" tabindex="-1" role="dialog" aria-labelledby="infobiDetailsModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title " align="center" id="exampleModalLabel">Infobip Details</h3>
            </div>
            @using (Ajax.BeginForm("saveInfobip", "SuperAdmin", new AjaxOptions { HttpMethod = "POST", OnSuccess = "OnSuccess", OnFailure = "OnFailure" }))
            {
                <div class="modal-body">

                    <div class="col-sm-offset-1 form-horizontal">

                        <div class="form-group">
                            <label class="  col-lg-4">URL</label>
                            <div class="col-lg-4">
                                @Html.TextBoxFor(m => m.infoBip_baseurl, new { @class = "form-control",@id= "infobipurl" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-lg-4">Infobip Key</label>
                            <div class="col-lg-4">
                                @Html.TextBoxFor(m => m.infoBip_key, new { @class = "form-control", @id = "infobipkey" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="  col-lg-4">Username</label>
                            <div class="col-lg-4">
                                @Html.TextBoxFor(m => m.infoBip_username, new { @class = "form-control", @id = "infobipusername" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="  col-lg-4">Password</label>
                            <div class="col-lg-4">
                                @Html.TextBoxFor(m => m.infoBip_password, new { @class = "form-control", @id = "infobippwd" })
                            </div>
                        </div>
                        @Html.HiddenFor(model => model.id, new { @id = "txtinfobipId" })
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    <input type="submit" value="Save" id="infobipsubmit" class="btn btn-success pull-right" />
                </div>
            }
            </div>
    </div>
</div>

<div class="panel panel-primary">
    <div class="panel-heading">
        Infobip Details @if (ViewBag.addInfoBip == 0)
        {<button type="button" style="float:right;height:30px;width:100px;margin-top:-5px;" title="Add Scheduler" class="btn btn-success" data-toggle="modal" data-target="#infobiDetailsModal" id="btnmodalcallinfobip">Add</button>}
    </div>
    <div class="panel-body">
        <div class="panel panel-primary tab-pane" id="infobipDiv">
            <div class="panel-body inf-content">

                <div class="dataTable_wrapper">
                    <table class="table table-striped table-bordered table-hover" style="width:100%" id="infobiptype">

                        <thead>
                            <tr>
                                <th>InfoBip Baseurl</th>
                                <th>InfoBip Key</th>
                                <th>InfoBip Username</th>
                                <th>InfoBip Password</th>
                                <th>Edit</th>

                            </tr>
                        </thead>

                    </table>
                    <span id="tblException"></span>
                </div>
            </div>
        </div>
    </div>

</div>
@section scripts
{
    <script>
        $(document).ready(function () {

            getinfobipDetails();
        });

        function getinfobipDetails() {


            $("#infobiptype").DataTable(
                {
                    "bDestroy": true,

                    "ajax": {

                        "url": siteRoot + "/SuperAdmin/GetInfobipType/",
                        "type": "POST",
                        "datatype": "json",
                    },
                    "columns": [
                        { "data": "infoBip_baseurl", "name": "infoBip_baseurl" },
                        { "data": "infoBip_key", "name": "infoBip_key" },
                        { "data": "infoBip_username", "name": "infoBip_username" },
                        { "data": "infoBip_password", "name": "infoBip_password" },
                        {
                            "data": "Action", render: function (data, type, row) {
                                return `<a class="fa fa-pencil-square"
                                                href="#" onclick="editInfobip(${row.id},'${row.infoBip_baseurl}','${row.infoBip_password}','${row.infoBip_key}','${row.infoBip_username}')" style="color: red">Edit </a>`
                            }
                        }
                    ],
                    "initComplete": function (data) {
                        $('#tblException').text(data.json.exception);
                    },
                    "scrollX": "true",
                    "scrollY": "300",
                    "language": {
                        "processing": "Loading Please Wait.....!"


                    },

                });

        }

        function editInfobip(id,infobipurl, infobipPassword, infobipkey, infobipusername) {

            $("#txtinfobipId").val(id);
            $("#infobipurl").val(infobipurl);
            $("#infobipkey").val(infobipkey);
            $("#infobipusername").val(infobipusername);
            $("#infobippwd").val(infobipPassword);

            $('#infobiDetailsModal').modal('show');

        }

        function OnSuccess(res) {
            if (res.success == true) {
                $('#infobiDetailsModal').hide();
                Lobibox.notify('success', {
                    msg: res.message
                });
                $('#infobipurl').val('');
                $('#infobipkey').val('');
                $('#infobipusername').val('');
                $('#infobippwd').val('');
                $('#infobiDetailsModal').modal('hide');
                getinfobipDetails();


            }
            else if (res.success == false) {
                Lobibox.notify('warning', {
                    msg: res.error
                });
            }
            $('#mainLoader').fadeOut('slow');

        }

        function OnFailure(res) {
            $('#mainLoader').fadeOut('slow');

            console.log(res);
            Lobibox.notify('success', {
                msg: 'Internal Server Error,Something went wrong'
            });
        }

        $('#infobipsubmit').click(function () {
            $('#mainLoader').fadeIn('slow');

            var infobip_url = $("#infobipurl").val();
            var infobip_key = $("#infobipkey").val();
            var infobip_username = $("#infobipusername").val();
            var infobip_pwd = $("#infobippwd").val();
        });




    </script>
}
