
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Manage Schedueler</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" type="image/png" href="~/public/images/favicon1.ico">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <title>AutoSherpaCRM</title>
    @Styles.Render("~/Content/css")
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .ribben {
            width: 100%;
            min-height: 66px;
            max-height: 150px;
            background-color: transparent;
        }

        .mainContainer {
            background-color: #ece7e7;
            width: 100%;
            height: 100vh;
        }

        .mybtn {
            position: relative;
            display: inline-block;
            font-weight: bold;
            padding: 0.25em 0.5em;
            text-decoration: none;
            color: #00BCD4;
            background: #ECECEC;
            border-radius: 15px 15px 15px 15px;
            transition: .4s;
            margin: 8px;
            box-shadow: 6px 6px 12px #b8b9be,-6px -6px 12px #fff !important;
            border: .0625rem solid #fafbfe !important;
            border-color: #d1d9e6 !important;
            box-sizing: border-box;
            font-size: 13pt;
        }

        .mybtngreen {
            position: relative;
            display: inline-block;
            font-weight: bold;
            padding: 0.25em 0.5em;
            text-decoration: none;
            color: #fff;
            background: #2eb132;
            border-radius: 15px 15px 15px 15px;
            transition: .4s;
            margin: 8px;
            box-shadow: 6px 6px 12px #b8b9be,-6px -6px 12px #fff !important;
            border: .0625rem solid #fafbfe !important;
            border-color: #d1d9e6 !important;
            box-sizing: border-box;
            font-size: 13pt;
        }

            .mybtn:hover {
                background: #3F51B5;
                color: white;
            }

        .mybtngreen:hover {
            background: #3fa5b5;
            color: white;
        }

        .subContainer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-50%);
            width: 35%;
        }
    </style>
</head>
<body>
    <div class="mainContainer">
        <div class="ribben">
            <div class="pull-left">
                <span style="font-size: 35pt;color: #ea0e0e;font-weight: 600;">AUTO</span>
                <span style=" font-size: 32pt;color: #503e5a;font-family: monospace;font-weight:550;">Sherpas</span>
            </div>
        </div>
        <div class="subContainer">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <label>Select Scheduler</label>
                    @Html.DropDownList("ddlScheduler", (IEnumerable<SelectListItem>)ViewBag.schedulerList, "--Select--", new { @class = "form-control", @id = "ddlScheduler" })
                </div>
            </div>
            <div class="row">
                <div class="col-md-3 col-sm-12">
                    <br />
                    <a href="#" id="start" onclick="doSchedulerJob('start');" class="mybtn">Resume</a>
                </div>
                <div class="col-md-3 col-sm-12">
                    <br />
                    <a href="#" id="stop" onclick="doSchedulerJob('stop');" class="mybtn">Pause</a>
                </div>
                <div class="col-md-3 col-sm-12">
                    <br />
                    <a href="#" id="reschedule" onclick="doSchedulerJob('reschedule');" class="mybtn">Reschedule</a>
                </div>
                <div class="col-md-3 col-sm-12">
                    <br />
                    <a href="#" id="status" onclick="doSchedulerJob('status');" class="mybtn">Status</a>
                </div>
            </div>
            <div class="row" id="reschedule_div">
                <div class="col-md-6">
                    <label>Enter IntervalOfTime in Min</label>
                    <input type="number" min="0" max="100" class="form-control" id="timeInMin" />
                </div>
            </div>
            <div class="row" id="status_div" style="display:none;">
                <div class="col-md-4 col-md-offset-4">
                    <label>Status of the Job:</label><br />
                    <span style="font-weight:bold;" id="jobStatus"></span>
                </div>
            </div>

            <div class="row">
                <div class="col-md-3 col-sm-12">
                    <br />
                    <a href="#" id="status" onclick="runJob('FE-Push');" class="mybtngreen">Run FE-PUSH</a>
                </div>
                <div class="col-md-3 col-sm-12">
                    <br />
                    <a href="#" id="status" onclick="runJob('FE-Pull');" class="mybtngreen">Run FE-PULL</a>
                </div>
                <div class="col-md-3 col-sm-12">
                    <br />
                    <a href="#" id="status" style="margin-right:-10px" onclick="runJob('CallSynch');" class="mybtngreen">Run Call Synch</a>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3 col-sm-12">
                    <br />
                    <a href="#" id="status" onclick="runJob('SMR-Push');" class="mybtngreen">SMR-PUSH</a>
                </div>
                <div class="col-md-3 col-sm-12">
                    <br />
                    <a href="#" id="status" onclick="runJob('AutoSMSCron');" class="mybtngreen">Auto-SMS-Cron</a>
                </div>
                <div class="col-md-3 col-sm-12">
                    <br />
                    <a href="#" id="status" onclick="runJob('Events');" class="mybtngreen">Events</a>
                </div>

            </div>

            <div class="row">
                <div class="col-md-3 col-sm-12">
                    <br />
                    <a href="#" id="status" onclick="runJob('Driver-Push');" class="mybtngreen">Run Driver Push</a>
                </div>
                @*<div class="col-md-3 col-sm-12">
                <br />
                <a href="#" id="status" onclick="runJob('Driver-Pull');" class="mybtngreen">Run Driver Pull</a>
            </div>*@
            </div>
        </div>
        </div>

        <div class="row">
            <div class="col-md-3 col-sm-12">
                <br />
                <input type="text" id="feFirebase" class="form-control" />
            </div>
            <div class="col-md-3 col-sm-12">
                <br />
                <a href="#" id="status" onclick="runDuplicate();" class="mybtngreen">Run duplicate deletion.</a>
            </div>
            <div class="col-md-3 col-sm-12">
                <br />
                <a href="#" id="status" onclick="getStatus()" class="mybtngreen">Get Status</a>
            </div>
           
        </div>
    </div>
    <div class="row">
        <div class="col-md-12 col-sm-12">
            <br />
            <span id="txtStatus" style="font-size:14pt;color:darkblue"></span>
        </div>
    </div>

    @Scripts.Render("~/bundles/jquery")
    <script type="text/javascript">
        var siteRoot = '@Request.ApplicationPath';
        if (siteRoot === '/') {
            siteRoot = "";
        }
        function doSchedulerJob(operation) {

            var scheduler = $('#ddlScheduler').val();
            var min = $('#timeInMin').val();

            if (min == "" && operation == "reschedule") {
                alert('Please specify the minute(s)');
                return false;
            }
            var stopConfirm = true;
            if (operation == 'stop') {

                if (confirm("Scheduler will permanently stops,Do you want?")) {
                    stopConfirm = true;
                }
                else {
                    stopConfirm = false;
                }
            }

            if (stopConfirm == true) {
                if (scheduler != "") {
                    $.ajax({
                        url: siteRoot + '/UserLog/doSchedulerJob/',
                        type: 'post',
                        dataType: 'json',
                        data: { opr: operation, scheduler: scheduler, min: min },
                        success: function (res) {
                            if (res.success == true) {
                                $('#status_div').hide();
                                if (res.opr == "start") {
                                    alert('Scheduler resumed');
                                }
                                else if (res.opr == "stop") {
                                    alert('Scheduler pauses');
                                }
                                else if (res.opr == "status") {
                                    $('#jobStatus').text(res.status);
                                    $('#status_div').show();
                                }
                                else if (res.opr == "reschedule") {
                                    alert('Scheduler rescheduld!Job have been triggered');
                                }
                                else {
                                    alert("Improper Command");
                                }
                            }
                            else {
                                alert(res.exception);
                            }
                        },
                        error: function (error) {
                            alert(error);
                            console.log(error);
                        }
                    });
                }
                else {
                    alert('Please Select Scheduler');
                }
            }
        }

        function runJob(jobName) {
            $.ajax({
                url: siteRoot + '/UserLog/runJob/',
                type: 'post',
                dataType: 'json',
                data: { jobName: jobName },
                success: function (res) {
                    if (res.success == true) {
                        alert('Job Started....');
                    }
                    else {
                        alert(res.exception);
                    }
                },
                error: function (error) {
                    alert(error);
                    console.log(error);
                }
            });
        }

        function runDuplicate() {

            var fireURL = $('#feFirebase').val();


            if (fireURL != "") {
                $.ajax({
                    url: siteRoot + '/UserLog/deleteDuplicate/',
                    type: 'post',
                    dataType: 'json',
                    data: { fireBaseLink: fireURL },
                    success: function (res) {
                        if (res.success == true) {
                            alert('Job Started....')
                        }
                        else {
                            alert(res.exception);
                        }
                    },
                    error: function (error) {
                        alert(error);
                        console.log(error);
                    }
                });
            }
            else {
                alert("Please Give URL");
            }
           
        }

        function getStatus() {

            var fireURL = $('#feFirebase').val();


            if (fireURL != "") {
                $.ajax({
                    url: siteRoot + '/UserLog/getSynchDetails/',
                    type: 'post',
                    dataType: 'json',
                    data: { syndhStatus: fireURL },
                    success: function (res) {
                        if (res.success == true) {
                            $('#txtStatus').text(res.data);
                        }
                        else {
                            alert(res.msg);
                        }
                    },
                    error: function (error) {
                        alert(error);
                        console.log(error);
                    }
                });
            }
            else {
                alert("Please Give Status");
            }
           
        }
    </script>
</body>
</html>
