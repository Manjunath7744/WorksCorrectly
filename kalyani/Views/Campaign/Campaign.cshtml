@model AutoSherpa_project.Models.campaign

@{
    ViewBag.Title = "addCustomer";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="panel panel-primary">
    <div class="panel-heading">
        Campaign Details
    </div>
    <div class="panel-body">
        @using (Ajax.BeginForm("CampaignPost", "Campaign", new AjaxOptions { HttpMethod = "POST", OnSuccess = "OnSuccess", OnFailure = "OnFailure" }))
        {
            <div class="row">

                <div class="col-md-3">
                    @Html.Label("Module Type")
                    @if (Session["LoginUser"].ToString() == "Service" && Session["UserRole"].ToString() != "SuperAdmin")
                    {
                        @Html.DropDownListFor(m => m.campaignType, new List<SelectListItem> {
                              new SelectListItem{Text="SMR",Value="Campaign"},
                                new SelectListItem{Text="PSF",Value="PSF"},
                                new SelectListItem{Text="TaggingSMR",Value="TaggingSMR" }
                        }, "--Select--", new { @class = "form-control", @id = "campaignTypeID", @required = "required" })
                    }
                    @if (Session["LoginUser"].ToString() == "Insurance" && Session["UserRole"].ToString() != "SuperAdmin")
                    {
                        @Html.DropDownListFor(m => m.campaignType, new List<SelectListItem> {
                              new SelectListItem{Text="Insurance",Value="Insurance"},
                              new SelectListItem{ Text="TaggingINS",Value="TaggingINS"}
                        }, "--Select--", new { @class = "form-control", @id = "campaignTypeID", @required = "required" })
                    }
                    @if (Session["UserRole"].ToString() == "SuperAdmin")
                    {
                        @Html.DropDownListFor(m => m.campaignType, new List<SelectListItem> {
                              new SelectListItem{Text="SMR",Value="Campaign"},
                                new SelectListItem{Text="PSF",Value="PSF"},
                                new SelectListItem{Text="TaggingSMR",Value="TaggingSMR" },
                                new SelectListItem{Text="Insurance",Value="Insurance"},
                              new SelectListItem{ Text="TaggingINS",Value="TaggingINS"}
                        }, "--Select--", new { @class = "form-control", @id = "campaignTypeID", @required = "required" })
                    }
                </div>
                <div class="col-md-3">
                    @Html.Label("Campaign Name")
                    @Html.TextBoxFor(m => m.campaignName, new { @class = "form-control", @id = "campName", @required = "required" })

                </div>
                <div class="col-md-3">
                    @Html.Label("Select From Date")
                    @Html.TextBoxFor(m => m.createdDate, new { @class = "form-control", @id = "date-picker-one", @autocomplete = "off", @required = "required" })

                </div>
                <div class="col-md-3">
                    @Html.Label("Select  Expiry Date")
                    @Html.TextBoxFor(m => m.expiryDate, new { @class = "form-control", @id = "date-picker-two", @autocomplete = "off", @required = "required" })

                </div>

            </div>
            <br />
            <div class="row">
                <div class="col-md-3 pull-right">
                    <input type="submit" name="campaignSubmit" value="Submit" class="btn btn-success" />
                </div>
            </div>
        }
        <br />
        <div class="panel panel-primary tab-pane" id="campaignDiv">
            <div class="panel-body inf-content">

                <div class="dataTable_wrapper">
                    <table class="table table-striped table-bordered table-hover" style="width:100%" id="campaigntype">

                        <thead>
                            <tr>
                                <th>Campaign Name</th>
                                <th>Campaign Type</th>
                                <th>isActive</th>

                            </tr>
                        </thead>

                    </table>
                    <span id="tblException"></span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 col-sm-12">
                <span class="code" id="tblException" style="font-size:11pt;font-weight:bold;"></span>
            </div>
        </div>
    </div>

</div>

@section scripts{
    <script>
        $(document).ready(function () {
          var campaignDatatable=  $("#campaigntype").DataTable(
                {
                    "ajax": {
                        "url": siteRoot +  "/Campaign/GetCampaign/",
                        "type": "POST",
                        "datatype": "json",
                    },
                    "columns": [
                        { "data": "campaignName", "name": "campaignName" },
                        { "data": "campaignType", "name": "campaignType" },
                        {
                            "data": "isactive", "name": "isactive", render: function (data, type, row) {
                                var value = "is_active";
                                if (row.isactive == true) {
                                    return `<a href="#" onclick="activatedeactivatecampaign(${row.id} ,'is_active');" style="color:green">Deactivte</a>`;
                                }
                                else {
                                    return `<a href="#" onclick="activatedeactivatecampaign(${row.id} ,'is_active');" style="color:red">Activte</a>`;
                                }
                            }
                        },
                    ],
                    "initComplete": function (data) {
                        $('#tblException').text(data.json.exception);
                        if ('@Session["UserRole"].ToString()' == "CREManager")
                        {
                            campaignDatatable.columns(2).visible(false)
                        }
                        else
                        {
                            campaignDatatable.columns(2).visible(true)
                        }
                    },

                    "serverSide": false,
                    "scrollX": "true",
                    "scrollY": "300",
                    "paging": true,
                    "searching": true,
                    "language": {
                        "processing": "Loading Please Wait.....!"


                    },

                });
        });


        $(document).ready(function () {

            $("#date-picker-two").datepicker({
                dateFormat: 'dd/mm/yy',
                changeMonth: true,
                changeYear: true,
                minDate: new Date()
            }).datepicker("setDate", new Date());
            $("#date-picker-one").datepicker({
                dateFormat: 'dd/mm/yy',
                changeMonth: true,
                changeYear: true,
                onSelect: function () {
                    $('#date-picker-two').datepicker('option', 'minDate', $("#date-picker-one").datepicker("getDate"));
                }
            }).datepicker("setDate", new Date());
        });


        function OnSuccess(res) {
            if (res.success == true) {
                Lobibox.notify('success', {
                    msg: res.message
                });
                $('#campaignTypeID').val('');
                $('#campName').val('');
                $('#date-picker-one').val('');
                $('#date-picker-two').val('');
            }
            else if (res.success == false) {
                Lobibox.notify('warning', {
                    msg: res.error
                });
            }
        }

        function OnFailure(res) {
            console.log(res);
            Lobibox.notify('success', {
                msg: 'Internal Server Error,Something went wrong'
            });
        }

        $("#campName").keypress(function (e) {
            var key = e.keyCode || e.which;
            console.log(key + "");
            if ((key >= 97 && key <= 122) || (key >= 65 && key <= 90) || (key >= 48 && key <= 57) || key == 32) {
                //No Action
            }
            else {
                Lobibox.notify('warning', {
                    continueDelayOnInactiveTab: true,
                    msg: 'Only alphabates are allowed.'
                });

                return false;
            }
        });

        function activatedeactivatecampaign(id, values) {
            
            $.ajax({
                "type": 'POST',
                "url": siteRoot + "/Campaign/UpdateActivatedeactivate",
                "datatype": 'json',
                "data": { id: id, value: values },
                success: function (res) {
                    console.log(res);

                    if (res.success == true) {
                        Lobibox.notify('warning', {
                            continueDelayOnInactiveTab: true,
                            msg: 'changed successfully'
                        });
                        //alert(" successfully");
                        location.reload();
                    }
                    else if (res.success == false) {
                        Lobibox.notify('warning', {
                            continueDelayOnInactiveTab: true,
                            msg: 'not successful'
                        });
                    }

                }, error(error) {

                }
            });

        }


    </script>
}
